!function(o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof exports?module.exports=o(require("jquery")):o(jQuery)}(function(o){function e(e,r){var i=o('<div class="colourpicker" />'),t=o.colourpicker.defaults;e.data("colourpicker-initialized")||(r=o.extend(!0,{},t,r),void 0!==r.position&&o.each(r.position.split(" "),function(){i.addClass("colourpicker-position-"+this)}),e.addClass("colourpicker-input").data("colourpicker-initialized",!1).data("colourpicker-settings",r).prop("size",7).wrap(i).after('<div class="colourpicker-panel"><div class="colourpicker-slider colourpicker-sprite"><div class="colourpicker-picker"></div></div><div class="colourpicker-grid colourpicker-sprite"><div class="colourpicker-grid-inner"></div><div class="colourpicker-picker"><div></div></div></div></div>'),e.parent().find(".colourpicker-panel").on("selectstart",function(){return!1}).end(),n(e,!1),e.data("colourpicker-initialized",!0))}function r(o){var e=o.parent();o.removeData("colourpicker-initialized").removeData("colourpicker-settings").removeProp("size").removeClass("colourpicker-input"),e.before(o).remove()}function i(o){var e=o.parent(),r=e.find(".colourpicker-panel"),i=o.data("colourpicker-settings");!o.data("colourpicker-initialized")||o.prop("disabled")||e.hasClass("colourpicker-focus")||(t(),e.addClass("colourpicker-focus"),r.stop(!0,!0).fadeIn(i.showSpeed,function(){i.show&&i.show.call(o.get(0))}))}function t(){o(".colourpicker-focus").each(function(){var e=o(this),r=e.find(".colourpicker-input"),i=e.find(".colourpicker-panel"),t=r.data("colourpicker-settings");i.fadeOut(t.hideSpeed,function(){t.hide&&t.hide.call(r.get(0)),e.removeClass("colourpicker-focus")})})}function c(o,e,r){var i=o.parents(".colourpicker").find(".colourpicker-input"),t=i.data("colourpicker-settings"),c=o.find("[class$=-picker]"),n=o.offset().left,u=o.offset().top,s=Math.round(e.pageX-n),l=Math.round(e.pageY-u),p=r?t.animationSpeed:0;e.originalEvent.changedTouches&&(s=e.originalEvent.changedTouches[0].pageX-n,l=e.originalEvent.changedTouches[0].pageY-u),0>s&&(s=0),0>l&&(l=0),s>o.width()&&(s=o.width()),l>o.height()&&(l=o.height()),o.is(".colourpicker-grid")?c.stop(!0).animate({top:l+"px",left:s+"px"},p,t.animationEasing,function(){a(i,o)}):c.stop(!0).animate({top:l+"px"},p,t.animationEasing,function(){a(i,o)})}function a(o,e){function r(o,e){var r,i;return o.length&&e?(r=o.offset().left,i=o.offset().top,{x:r-e.offset().left+o.outerWidth()/2,y:i-e.offset().top+o.outerHeight()/2}):null}var i,t,c,a=o.val(),n=o.parent(),s=o.data("colourpicker-settings"),p=n.find(".colourpicker-grid"),d=n.find(".colourpicker-slider"),f=p.find("[class$=-picker]"),k=d.find("[class$=-picker]"),g=r(f,p),b=r(k,d);switch(e.is(".colourpicker-grid, .colourpicker-slider")&&(i=l(360-parseInt(b.y*(360/d.height()),10),0,360),t=l(Math.floor(g.x*(100/p.width())),0,100),c=l(100-Math.floor(g.y*(100/p.height())),0,100),a=h({h:i,s:t,b:c}),p.css("backgroundColor",h({h:i,s:100,b:100})),o.val(a.toUpperCase())),s.showColour){case"text":o.css("color",""),o.css("background-color","");break;case"background":o.css("color","transparent"),o.css("background-color",a);break;default:o.css("color",v(a)),o.css("background-color",a)}u(o,a)}function n(o,e){var r,i,t,c,a=o.parent(),n=o.data("colourpicker-settings"),p=a.find(".colourpicker-grid"),d=a.find(".colourpicker-slider"),k=p.find("[class$=-picker]"),g=d.find("[class$=-picker]");switch(r=s(o.val(),!0).toUpperCase(),r||(r=s(n.defaultValue,!0).toUpperCase()),i=f(r),e||o.val(r),n.showColour){case"text":o.css("color",""),o.css("background-color","");break;case"background":o.css("color","transparent"),o.css("background-color",r);break;default:o.css("color",v(r)),o.css("background-color",r)}t=l(Math.ceil(i.s/(100/p.width())),0,p.width()),c=l(p.height()-Math.ceil(i.b/(100/p.height())),0,p.height()),k.css({top:c+"px",left:t+"px"}),c=l(d.height()-i.h/(360/d.height()),0,d.height()),g.css("top",c+"px"),p.css("backgroundColor",h({h:i.h,s:100,b:100})),o.data("colourpicker-initialized")&&u(o,r)}function u(o,e){var r=o.data("colourpicker-settings"),i=o.data("colourpicker-lastChange");i&&i.hex===e||(o.data("colourpicker-lastChange",{hex:e}),r.change&&(r.changeDelay?(clearTimeout(o.data("colourpicker-changeTimeout")),o.data("colourpicker-changeTimeout",setTimeout(function(){r.change.call(o.get(0),e)},r.changeDelay))):r.change.call(o.get(0),e)),o.trigger("change").trigger("input"))}function s(o,e){return o=o.replace(/[^A-F0-9]/gi,""),3!==o.length&&6!==o.length?"":(3===o.length&&e&&(o=o[0]+o[0]+o[1]+o[1]+o[2]+o[2]),"#"+o)}function l(o,e,r){return e>o&&(o=e),o>r&&(o=r),o}function p(o){var e={},r=Math.round(o.h),i=Math.round(255*o.s/100),t=Math.round(255*o.b/100);if(0===i)e.r=e.g=e.b=t;else{var c=t,a=(255-i)*t/255,n=(c-a)*(r%60)/60;360===r&&(r=0),60>r?(e.r=c,e.b=a,e.g=a+n):120>r?(e.g=c,e.b=a,e.r=c-n):180>r?(e.g=c,e.r=a,e.b=a+n):240>r?(e.b=c,e.r=a,e.g=c-n):300>r?(e.b=c,e.g=a,e.r=a+n):360>r?(e.r=c,e.g=a,e.b=c-n):(e.r=0,e.g=0,e.b=0)}return{r:Math.round(e.r),g:Math.round(e.g),b:Math.round(e.b)}}function d(e){var r=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];return o.each(r,function(o,e){1===e.length&&(r[o]="0"+e)}),"#"+r.join("")}function h(o){return d(p(o))}function f(o){var e=k(g(o));return 0===e.s&&(e.h=360),e}function k(o){var e={h:0,s:0,b:0},r=Math.min(o.r,o.g,o.b),i=Math.max(o.r,o.g,o.b),t=i-r;return e.b=i,e.s=0!==i?255*t/i:0,e.h=0!==e.s?o.r===i?(o.g-o.b)/t:o.g===i?2+(o.b-o.r)/t:4+(o.r-o.g)/t:-1,e.h*=60,e.h<0&&(e.h+=360),e.s*=100/255,e.b*=100/255,e}function g(o){return o=parseInt(o.indexOf("#")>-1?o.substring(1):o,16),{r:o>>16,g:(65280&o)>>8,b:255&o}}function v(o){return b(o)>.22?"#000":"#ddd"}function b(e){var r=g(e);r=o.map(r,function(o){return o/=255,o=.03928>=o?o/12.92:Math.pow((o+.055)/1.055,2.4)});var i=.2126*r[0]+.7152*r[1]+.0722*r[2];return i}o.colourpicker={defaults:{animationSpeed:50,animationEasing:"swing",change:null,changeDelay:0,defaultValue:"",hide:null,hideSpeed:100,position:"bottom left",show:null,showSpeed:100,showColour:"both"}},o.extend(o.fn,{colourpicker:function(c,a){switch(c){case"destroy":return o(this).each(function(){r(o(this))}),o(this);case"hide":return t(),o(this);case"settings":return void 0===a?o(this).data("colourpicker-settings"):(o(this).each(function(){var e=o(this).data("colourpicker-settings")||{};r(o(this)),o(this).colourpicker(o.extend(!0,e,a))}),o(this));case"show":return i(o(this).eq(0)),o(this);case"value":return void 0===a?o(this).val():(o(this).each(function(){n(o(this).val(a))}),o(this));default:return"create"!==c&&(a=c),o(this).each(function(){e(o(this),a)}),o(this)}}}),o(document).on("mousedown.colourpicker touchstart.colourpicker",function(e){o(e.target).parents().add(e.target).hasClass("colourpicker")||t()}).on("mousedown.colourpicker touchstart.colourpicker",".colourpicker-grid, .colourpicker-slider",function(e){var r=o(this);e.preventDefault(),o(document).data("colourpicker-target",r),c(r,e,!0)}).on("mousemove.colourpicker touchmove.colourpicker",function(e){var r=o(document).data("colourpicker-target");r&&c(r,e)}).on("mouseup.colourpicker touchend.colourpicker",function(){o(this).removeData("colourpicker-target")}).on("focus.colourpicker",".colourpicker-input",function(){var e=o(this);e.data("colourpicker-initialized")&&i(e)}).on("blur.colourpicker",".colourpicker-input",function(){var e=o(this),r=e.data("colourpicker-settings");e.data("colourpicker-initialized")&&(e.val(s(e.val(),!0)),""===e.val()&&e.val(s(r.defaultValue,!0)),e.val(e.val().toUpperCase()))}).on("keydown.colourpicker",".colourpicker-input",function(e){var r=o(this);if(r.data("colourpicker-initialized"))switch(e.keyCode){case 9:t();break;case 13:case 27:t(),r.blur()}}).on("keyup.colourpicker",".colourpicker-input",function(){var e=o(this);e.data("colourpicker-initialized")&&n(e,!0)}).on("paste.colourpicker",".colourpicker-input",function(){var e=o(this);e.data("colourpicker-initialized")&&setTimeout(function(){n(e,!0)},1)})});
